<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-flex-layout/classes/iron-flex-layout.html">


<dom-module is="prono-check">
	<template>
		<style>
			:host{
				display: block;
			}
			
		</style>
		
		<div id="status">
			{{message(status,passMessage,failMessage)}}		
		</div>
			
	</template>
	<script>
		Polymer({
			is: 'prono-check',
			properties: {
				prono: {
					type: 'Array',
					observer: 'check'
				},
				status: {
					type: 'Number',
					notify: true,
					value: 0
				},
				date: {
					type: 'Number',
					value: 0
				},
				passMessage: {
					type: 'String',
					value: 'Dit deel is compleet!'
				},
				failMessage: {
					type: 'String',
					value: 'Dit deel is nog niet compleet en moet ingevuld worden voor %d'
				},
				condition:{
					type: 'String',
					value: 'true'
				},
			},
			check: function(prono){
        		eval('function callBack(prono){ return '+ this.condition +'}');

				var tempstatus = 1;
				prono.forEach(function(p){
					if(!callBack(p)){
						tempstatus = 0;
					}
				});

				this.status = tempstatus;
			},
			message: function(status,passMessage,failMessage){
				if(status==1){
					return passMessage;
				}
				else{
					return failMessage.replace('%d', this.formatDate(this.date));
				}
			},
			trans: function(key){
				return app.trans(key,{});
			},
			formatDate: function(timestamp){
				var date = new Date(timestamp * 1000);
				var day = date.getDate();
				var month = (date.getMonth()+1)
				var year = date.getFullYear();
				var hours = date.getHours();
				var minutes = date.getMinutes();
				return (day < 10? '0' : '') + day + '-' + (month < 10? '0' : '') + month + '-' + date.getFullYear() + ' ' + (hours < 10? '0' : '') + hours + ':' +  (minutes < 10? '0' : '') + minutes;
			},
		});
	</script>
</dom-module>
