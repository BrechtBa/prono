
<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../../bower_components/paper-dialog-scrollable/paper-dialog-scrollable.html">
<link rel="import" href="../../bower_components/neon-animation/neon-animations.html">
<link rel="import" href="../../bower_components/paper-material/paper-material.html">
<link rel="import" href="../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../../bower_components/iron-flex-layout/classes/iron-flex-layout.html">

<dom-module id="prono-groupstage">
	<template>

		<style>
			:host{
				display: block;
				width: 100%;
			}
			paper-card{
      			margin: 5px;
				cursor: pointer;
				padding: 10px;
    		}
			paper-card.group{
				width: 100%;
				max-width: 360px;
			}
			.score{
				width: 60px;
				text-align: center;
			}
			.icon{
				width: 30px;
				height: 30px;
			}
			.teamname.left{
				text-align: left;
			}
			.teamname.right{
				text-align: right;
			}
			paper-button.main{
      			background: #5C82C3;
      			color: #ffffff;
    		}
			.closeDialog{
				position: absolute;
				top: -20px;
				right: 10px;
				margin: 0px;
			}
		</style>

		<iron-ajax id="ajaxPut" method="PUT" handle-as="json" on-response="handleAjaxPutResponse" last-response="{{ajaxPutResponse}}" debounce-duration="300"></iron-ajax>
		<div class="horizontal layout wrap center-justified">

			<template is="dom-repeat" id="groupsList" items="{{groups}}">
				<paper-card elevation="1" class="group vertical layout">
					<h3>Group {{item.name}}</h3>
					<div class="matches">
						<template is="dom-repeat" id="matchesList" items="{{matchess}}" filter="{{filterGroupMatches(item.id)}}">
							<div class="match horizontal layout center center-justified" on-tap="editScore">
								<div class="teamname left flex">{{formatTeamName(item.team1,teams)}}</div>
								<div class="teamicon"><img class="icon" src="{{parseIcon(item.team1,teams)}}"></div>
								<div class="score">{{formatScore(item.score1)}} - {{formatScore(item.score2)}}</div>
								<div class="teamicon"><img class="icon" src="{{parseIcon(item.team2,teams)}}"></div>
								<div class="teamname right flex">{{formatTeamName(item.team2,teams)}}</div>
							</div>
						</template>
					</div>
				</paper-card>
			</template>

		<div class="horizontal layout wrap">


	</template>

	<script>
		Polymer({
			is: 'prono-groupstage',
			properties: {
				token: {
					type: 'String',
					value: '',
					notify: true
				},
				user: {
					type: 'Number',
					notify: true
				},
				teams: {
					type: 'Array',
					notify: true
				},
				groups: {
					type: 'Array',
					notify: true
				},
				matchess: {
					type: 'Array',
					notify: true
				},
			},
			ready: function(){
			},
			closeDialog: function(){
				//this.$.editScore.close();
			},
			editScore: function(e){
				console.log(e);
				console.log(e.target);
				//this.match = this.$.matchesList.itemForElement(e.target);
				//console.log(this.match);
			},
			saveScore: function(){
				/*this.$.ajaxPut.url = 'api/index.php/prono/'+this.team.id
				this.$.ajaxPut.headers['Authentication'] = this.token;
				this.$.ajaxPut.body = JSON.stringify({'id':this.newid,'name':this.team.name,'abr':this.team.abr,'iso_icon':this.team.iso_icon,'icon':this.team.icon});
				this.$.ajaxPut.generateRequest();
				this.$.editTeam.close();*/
			},
			handleAjaxPutResponse: function(event,request){
				/*var headers = request.xhr.getAllResponseHeaders();
				app.$.model.fire('get-teams');*/
			},
			filterGroupMatches: function(id){

				return function(item){
					return (item.grp == id);
			  	};
			},
			formatTeamName: function(id,teams){
				var name = '';
				teams.forEach(function(item){
					if(item.id == id){
						name = item.name;
					}
				});
				return name;
			},
			formatScore: function(score){
				if(score<0){
					return '';
				}
				else{
					return score;
				}
			},
			parseIcon: function(id,teams){
				var iso_icon='';
				var icon = '';
				teams.forEach(function(item){
					if(item.id == id){
						iso_icon = item.iso_icon;
						icon = item.icon;
					}
				});

				if(iso_icon != ''){
					return 'images/flags/'+iso_icon+'.png';
				}
				else{
					return icon;
				}
			},
			_sortMatches: function(a, b) {  
  
				if(parseInt(a.date) > parseInt(b.date)){
					return 1;
				}
				else if(parseInt(a.date) < parseInt(b.date)){
					return -1;
				}
				else{
					return 0;
				}
			},
		});
	</script>

</dom-module>
