<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/app-localize-behavior/app-localize-behavior.html">

<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout-classes.html">

<link rel="import" href="../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../bower_components/paper-material/paper-material.html">

<link rel="import" href="../bower_components/polymerfire/firebase-document.html">

<link rel="import" href="shared-styles.html">
<link rel="import" href="team-name.html">
<link rel="import" href="team-icon.html">


<dom-module id="prono-match">
    <template>
        <style include="iron-flex iron-flex-alignment"></style>
        <style include="shared-styles"></style>
        <style>
            :host{
                display: block;
                width: 100%;
            }
            .horizontal{
                @apply --layout-horizontal;
                @apply --layout-center;
                @apply --layout-center-justified;
            }
            .vertical{
                @apply --layout-vertical;
                @apply --layout-center;
                @apply --layout-center-justified;
            }
            .score{
                width: 60px;
                text-align: center;
                @apply --layout-horizontal;
                @apply --layout-center;
                @apply --layout-center-justified;
            }
            .teamicon{
                max-width: 30px;
                max-height: 30px;
            }
            .horizontal .teamname{
                @apply --layout-flex;
            }
            .horizontal .teamname.left{
                text-align: left;
            }
            .horizontal .teamname.right{
                text-align: right;
            }
			.collapsed .score{
			    width: 30px;
			    min-height: 80px;
			}
        </style>

        <firebase-document app-name="prono" path="/[[pronoGroupId]]/competition/matches/[[matchId]]" data="{{match}}"></firebase-document>
        <firebase-document app-name="prono" path="/[[pronoGroupId]]/competition/teams/[[match.team1]]" data="{{team1}}"></firebase-document>
        <firebase-document app-name="prono" path="/[[pronoGroupId]]/competition/teams/[[match.team2]]" data="{{team2}}"></firebase-document>

        <template is="dom-if" if="{{_hasValue(pronoUserId)}}">
            <firebase-document app-name="prono" path="/[[pronoGroupId]]/userpronos/[[pronoUserId]]/matches/[[matchId]]" data="{{prono}}"></firebase-document>
        </template>


        <div class$="{{_layoutClass(stage)}} {{_collapsedClass(collapsed)}}" on-tap="editScore">
            <div class$="teamname left {{_hiddenClass(hideTeamName)}}">
                <team-name team="{{team1}}" default="{{match.defaultteam1}}" abr="{{abrTeamName}}"></team-name>
            </div>
            <div class="teamicon">
                <team-icon team="{{team1}}"></team-icon>
            </div>
            <div class="score">
                <template is="dom-if" if="{{_hasValue(pronoUserId)}}">
                    {{_formatScore(pronoMatch.score1)}} - {{_formatScore(pronoMatch.score2)}}
                </template>
                <template is="dom-if" if="{{!_hasValue(pronoUserId)}}">
                    {{_formatScore(match.score1)}} - {{_formatScore(match.score2)}}
                </template>
            </div>
            <div  class="teamicon">
                <team-icon team="{{team2}}"></team-icon>
            </div>
            <div class$="teamname right {{_hiddenClass(hideTeamName)}}">
                <team-name team="{{team2}}" default="{{match.defaultteam2}}" abr="{{abrTeamName}}"></team-name>
            </div>
        </div>

    </template>

    <script>
        class PronoMatch extends Polymer.mixinBehaviors([Polymer.AppLocalizeBehavior], Polymer.Element){
            static get is() { return 'prono-match'; }

            static get properties() {
                return {
                    pronoGroupId: {
                        type: String,
                    },
                    matchId: {
                        type: String,
                    },
                    pronoUserId: {
                        type: String,
                        value: '',
                    },
                    stage: {
                        type: String,
                    },
                    collapsed: {
                        type: Boolean,
                        value: false,
                    },
                    abrTeamName: {
                        type: Boolean,
                        value: false,
                    },
                    hideTeamName: {
                        type: Boolean,
                        value: false,
                    },
                    language: {
                        value: 'nl-BE',
                    },
                    resources: {
                        value() {
                            return {
                                'en': { 'groupname': 'Group {group}' },
                                'nl-BE': { 'groupname': 'Groep {group}' }
                            }
                        }
                    },
                };
            }

            editScore(event){
                if(!this.collapsed){
                    console.log('show the edit score dialog')
                }
            }

            _formatScore(score){
                if(score>-1){
                    return score;
                }
            }

            _hasValue(str){
                return str != ''
            }

            _layoutClass(stage){
                if(stage == 'groupstage'){
                    return 'horizontal'
                }
                else{
                    return 'vertical'
                }
            }

            _collapsedClass(collapsed){
                if(collapsed){
                    return 'collapsed';
                }
            }
            _hiddenClass(bool){
                if(bool){
                    return 'hidden';
                }
            }
        }

        window.customElements.define(PronoMatch.is, PronoMatch);
    </script>

</dom-module>
